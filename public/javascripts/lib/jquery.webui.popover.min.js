!function(a,b,c,d){function e(b,c){this.$element=a(b),this.options=a.extend({},i,c),this._defaults=i,this._name=f,this.init()}var f="webuiPopover",g="webui-popover",h="webui.popover",i={placement:"auto",width:"auto",height:"auto",trigger:"click",style:"",delay:300,cache:!0,multi:!1,arrow:!0,content:"",closeable:!1,padding:!1,url:"",type:"html",template:'<div class="webui-popover"><div class="arrow"></div><div class="webui-popover-inner"><div class="webui-popover-content"><i class="icon-refresh"></i></div></div></div>'};e.prototype={init:function(){"click"===this.options.trigger?this.$element.off("click").on("click",a.proxy(this.toggle,this)):this.$element.off("mouseenter mouseleave").on("mouseenter",a.proxy(this.mouseenterHandler,this)).on("mouseleave",a.proxy(this.mouseleaveHandler,this)),this._poped=!1,this._inited=!0},destroy:function(){this.hide(),this.$element.data("plugin_"+f,null),this.$element.off(),this.$target&&this.$target.remove()},hide:function(b){b&&(b.preventDefault(),b.stopPropagation());var c=a.Event("hide."+h);this.$element.trigger(c),this.$target&&this.$target.removeClass("in").hide(),this.$element.trigger("hidden."+h)},toggle:function(a){a&&(a.preventDefault(),a.stopPropagation()),this[this.getTarget().hasClass("in")?"hide":"show"]()},hideAll:function(){a("div.webui-popover").not(".webui-popover-fixed").removeClass("in").hide()},show:function(){var a=this.getTarget().removeClass().addClass(g);if(this.options.multi||this.hideAll(),!this.options.cache||!this._poped){if(this.options.closeable||a.find(".close").off("click").remove(),this.isAsync())return this.setContentASync(this.options.content),void this.displayContent();this.setContent(this.getContent()),a.show()}this.displayContent(),this.bindBodyEvents()},displayContent:function(){var b=this.getElementPosition(),d=this.getTarget().removeClass().addClass(g),e=this.getContentElement(),f=d[0].offsetWidth,i=d[0].offsetHeight,j="bottom",k=a.Event("show."+h);this.$element.trigger(k),"auto"!==this.options.width&&d.width(this.options.width),"auto"!==this.options.height&&e.height(this.options.height),this.options.arrow||d.find(".arrow").remove(),d.remove().css({top:-1e3,left:-1e3,display:"block"}).appendTo(c.body),f=d[0].offsetWidth,i=d[0].offsetHeight,j=this.getPlacement(b,i),this.initTargetEvents();var l=this.getTargetPositin(b,j,f,i);if(this.$target.css(l.position).addClass(j).addClass("in"),"iframe"===this.options.type){var m=d.find("iframe");m.width(d.width()).height(m.parent().height())}if(this.options.style&&this.$target.addClass(g+"-"+this.options.style),this.options.padding||this.$target.addClass("webui-no-padding"),this.options.arrow||this.$target.css({margin:0}),this.options.arrow){var n=this.$target.find(".arrow");n.removeAttr("style"),l.arrowOffset&&n.css(l.arrowOffset)}this._poped=!0,this.$element.trigger("shown."+h)},isTargetLoaded:function(){return 0===this.getTarget().find("i.glyphicon-refresh").length},getTarget:function(){return this.$target||(this.$target=a(this.options.template)),this.$target},getContentElement:function(){return this.getTarget().find("."+g+"-content")},hasContent:function(){return this.getContent()},getContent:function(){if(this.options.url)"iframe"===this.options.type&&(this.content=a('<iframe frameborder="0"></iframe>').attr("src",this.options.url));else if(!this.content){var b="";b=a.isFunction(this.options.content)?this.options.content.apply(this.$element[0],arguments):this.options.content,this.content=this.$element.attr("data-content")||b}return this.content},setContent:function(a){var b=this.getTarget();this.getContentElement().html(a),this.$target=b},isAsync:function(){return"async"===this.options.type},setContentASync:function(b){var c=this,d=this.getUid();a.ajax({url:this.options.url+"?uid="+d,type:"GET",cache:this.options.cache,success:function(d){b&&a.isFunction(b)?c.content=b.apply(c.$element[0],[d]):c.content=d,c.setContent(c.content);var e=c.getContentElement();e.removeAttr("style"),c.displayContent()}})},bindBodyEvents:function(){a("body").off("keyup.webui-popover").on("keyup.webui-popover",a.proxy(this.escapeHandler,this)),a("body").off("click.webui-popover").on("click.webui-popover",a.proxy(this.bodyClickHandler,this))},mouseenterHandler:function(){var a=this;a._timeout&&clearTimeout(a._timeout),a.getTarget().is(":visible")||a.show()},mouseleaveHandler:function(){var a=this;a._timeout=setTimeout(function(){a.hide()},a.options.delay)},escapeHandler:function(a){27===a.keyCode&&this.hideAll()},bodyClickHandler:function(){this.hideAll()},targetClickHandler:function(a){a.stopPropagation()},initTargetEvents:function(){"click"!==this.options.trigger&&this.$target.off("mouseenter mouseleave").on("mouseenter",a.proxy(this.mouseenterHandler,this)).on("mouseleave",a.proxy(this.mouseleaveHandler,this)),this.$target.find(".close").off("click").on("click",a.proxy(this.hide,this)),this.$target.off("click.webui-popover").on("click.webui-popover",a.proxy(this.targetClickHandler,this))},getUid:function(){var a=this.$element.data("uid");return a},getPlacement:function(a,b){var d,e=c.documentElement,f=c.body,g=e.clientWidth,h=e.clientHeight,i=Math.max(f.scrollTop,e.scrollTop),j=Math.max(f.scrollLeft,e.scrollLeft),k=Math.max(0,a.left-j),l=Math.max(0,a.top-i),m=20;return d="function"==typeof this.options.placement?this.options.placement.call(this,this.getTarget()[0],this.$element[0]):this.$element.data("placement")||this.options.placement,"auto"===d&&(g/3>k?d=h/3>l?"bottom-right":"top-right":2*g/3>k?d=h/3>l?"bottom":2*h/3>l?"bottom":"top":(d=l>b+m?"top-left":"bottom-left",d=h/3>l?"bottom-left":2*h/3>l?"left":"top-left")),d},getElementPosition:function(){return a.extend({},this.$element.offset(),{width:this.$element[0].offsetWidth,height:this.$element[0].offsetHeight})},getTargetPositin:function(a,b,c,d){var e=a,f=this.$element.outerWidth(),g=this.$element.outerHeight(),h={},i=null,j=this.options.arrow?28:0,k=j+10>f?j:0,l=j+10>g?j:0;switch(b){case"bottom":h={top:e.top+e.height,left:e.left+e.width/2-c/2};break;case"top":h={top:e.top-d,left:e.left+e.width/2-c/2};break;case"left":h={top:e.top+e.height/2-d/2,left:e.left-c};break;case"right":h={top:e.top+e.height/2-d/2,left:e.left+e.width};break;case"top-right":h={top:e.top-d,left:e.left-k},i={left:f/2+k};break;case"top-left":h={top:e.top-d,left:e.left-c+e.width+k},i={left:c-f/2-k};break;case"bottom-right":h={top:e.top+e.height,left:e.left-k},i={left:f/2+k};break;case"bottom-left":h={top:e.top+e.height,left:e.left-c+e.width+k},i={left:c-f/2-k};break;case"right-top":h={top:e.top-d+e.height+l,left:e.left+e.width},i={top:d-g/2-l};break;case"right-bottom":h={top:e.top-l,left:e.left+e.width},i={top:g/2+l};break;case"left-top":h={top:e.top-d+e.height+l,left:e.left-c},i={top:d-g/2-l};break;case"left-bottom":h={top:e.top,left:e.left-c},i={top:g/2}}return{position:h,arrowOffset:i}}},a.fn[f]=function(b){return this.each(function(){var c=a.data(this,"plugin_"+f);c?"destroy"===b?c.destroy():"string"==typeof b&&c[b]():(b?"string"==typeof b?"destroy"!==b&&(c=new e(this,null),c[b]()):"object"==typeof b&&(c=new e(this,b)):c=new e(this,null),a.data(this,"plugin_"+f,c))})}}(jQuery,window,document);