$(document).ready(function(){function a(a,d){h.addClass(1==a?"msgbox_success":"msgbox_error"),h.text(d),c(),setTimeout(b,1500)}function b(){h.removeClass("msgboxin"),h.addClass("msgboxout"),h.removeClass("msgbox_success"),h.removeClass("msgbox_error")}function c(){h.removeClass("msgboxout"),h.addClass("msgboxin")}function d(a){var b,c;for(c=0,b=0;b<a.length;b++)c+=a.charCodeAt(b)>=0&&a.charCodeAt(b)<=255?1:2;return c}var e=$(".username_text").map(function(a,b){return $(b).text().trim()}).toArray();e=_.uniq(e);var f={at:"@",data:e,show_the_at:!0};$inputor=$(".atreply").atwho(f);var g=$("body");g.after("<div id='gmsgbox' class='fade_trans msgboxout'></div>");var h=$("#gmsgbox");$("#searchtitle").click(function(){var b=$("#url").val(),c=$("#pub_link_brief");if(0==b.length)return a(!1,"输入不能为空"),!1;if(b.indexOf("http")<0)return a(!1,"链接地址不合法"),!1;var d={url:b};return $.ajax({data:d,url:"/getlinktitle",dataType:"json",cache:!1,timeout:5e3,type:"get",beforeSend:function(){$(".loading").css("display","inline-block")},success:function(b){return $(".loading").css("display","none"),0===b.status?(c.val(b.title),!1):1===b.status?(c.val(""),a(!1,b.title),c.attr("placeholder",b.title),!1):void 0}}),!1}),$("#sublink").click(function(){var b=$("#url").val(),c=$("#pub_link_brief");return 0==b.length?(a(!1,"输入不能为空"),!1):0==c.length?(a(!1,"链接简介是不是空的呀？"),!1):!0}),$("#subarticle").click(function(){var b=$("#post_body").val();return 0==b.length?(a(!1,"输入不能为空"),!1):b.length<10?(a(!1,"输入不能为空"),!1):!0}),$("#relatebtn").click(function(){var b=$(this).attr("data_id"),c=!1;c=$(this).hasClass("followfri")?!0:!1;var d={followuid:b,follow:c};$.ajax({data:d,url:"/newrelation",dataType:"json",cache:!1,timeout:5e3,type:"get",success:function(b){return"success"===b.status?($("#relatebtn").text($("#relatebtn").hasClass("followfri")?"取消关注-":"关注此人+"),$("#relatebtn").toggleClass("unfollowfri"),$("#relatebtn").toggleClass("followfri"),void a(!0,"操作成功!!")):("failed"===b.status&&a(!1,"请先登录!!"),void("error"===b.status&&a(!1,"发生错误!!")))}})}),$(".likebtn,.unlikebtn").click(function(){var b=$(this),c=b.attr("data-tid"),d=!0,e="表过态";d="赞"===b.attr("title")?!0:!1;var f={tid:c,islike:d};$.ajax({data:f,url:"/like",dataType:"json",cache:!1,timeout:5e3,type:"get",success:function(c){if(0===c.status){var d=""===b.children("span").text()?0:b.children("span").text();return b.children("span").text(d- -1),void a(!0,"操作成功!!")}return 1===c.status?void a(!1,"请先登录!!"):2===c.status?void a(!1,"已经"+e+"了!!"):3===c.status?void a(!1,"发生错误!!"):void 0}})}),$(".deleteitem").click(function(){if(confirm("你确定提交吗？")){var a=$(this),c=a.attr("data-tid"),d={tid:c};$.ajax({data:d,url:"/deletearticle",dataType:"json",cache:!1,timeout:5e3,type:"get",success:function(c){return 0===c.status?(a.parentsUntil(".user_near_article").remove(),h.addClass("msgbox_success"),h.text("删除成功!!"),h.removeClass("msgboxout"),h.addClass("msgboxin"),void setTimeout(b,1500)):3===c.status?($("#likeerr").remove(),h.addClass("msgbox_success"),h.text("发生错误!!"),h.removeClass("msgboxout"),h.addClass("msgboxin"),void setTimeout(b,1500)):void 0}})}}),$("#regBtnSub").click(function(){var a=$("#email").val(),b=$("#uname").val(),c=$("#pwd").val(),e=$("#pwdagain").val(),f=/^\w+((-\w+)|(\.\w+))*\@[A-Za-z0-9]+((\.|-)[A-Za-z0-9]+)*\.[A-Za-z0-9]+$/;if($(".msgbox").empty(),!f.test(a)){var g="<div class='alertsty' role='alert'>邮箱格式不正确,请重新输入</div>";return $(".msgbox").append(g),$("#email").focus(),!1}if(d(b)<6){var g="<div class='alertsty' role='alert'>账户最少超过6个字符哦</div>";return $(".msgbox").append(g),$("#name").focus(),!1}if(d(c)<6){var g="<div class='alertsty' role='alert'>密码过于简单..</div>";return $(".msgbox").append(g),$("#pwd").focus(),!1}if(c!=e){var g="<div class='alertsty' role='alert'>两次输入不一样</div>";return $(".msgbox").append(g),$("#pwdagain").focus(),!1}return!0}),$("#loginBtnSub").click(function(){var a=$("#uname").val(),b=$("#pwd").val();if($(".msgbox").empty(),0===a.length){var c="<div class='alertsty' role='alert'>账户为空</div>";return $(".msgbox").append(c),$("#name").focus(),!1}if(0===b.length){var c="<div class='alertsty' role='alert'>密码为空</div>";return $(".msgbox").append(c),$("#pwd").focus(),!1}return!0}),$("#tab_share_on").click(function(){$("#tab_link").removeClass("tab_on"),$("#tab_link").addClass("tab_off"),$("#tab_share").removeClass("tab_off"),$("#tab_share").addClass("tab_on"),$(this).addClass("share_tab_active"),$("#tab_link_on").removeClass("share_tab_active")}),$("#tab_link_on").click(function(){$("#tab_share").removeClass("tab_on"),$("#tab_share").addClass("tab_off"),$("#tab_link").removeClass("tab_off"),$("#tab_link").addClass("tab_on"),$(this).addClass("share_tab_active"),$("#tab_share_on").removeClass("share_tab_active")});var i=function(a,b,c,d){var e='<input type="hidden" name="tid" value="'+a+'">',f='<input type="hidden" name="rid" value="'+b+'">',g='<input type="hidden" name="ruid" value="'+c+'">',h='<input type="hidden" name="runame" value="'+d+'">',i='<textarea row="3" name="repstr" class="atreply" id="replytoreply" style="width:100%"></textarea>',j='<div class="inputopt"><button type="submit" class="btn  btn-sm">回复</button></div>',k='<form id="replywrap" class="navbar-form" action="/reply" method="post">',l="</form>";return k+i+e+f+g+h+j+l};$(".replyat").click(function(){$("#replywrap").remove();var a=$(this).attr("data-tid"),b=$(this).attr("data-rid"),c=$(this).attr("data-ruid"),d=$(this).attr("data-runame"),e=i(a,b,c,d);return $(this).parent().parent().parent().children(".reply_content").after(e),$("#replytoreply").focus(),$("#replytoreply").val("@"+d+" "),!1}),$("#add_label").click(function(){$("#add_label").css("display","none"),$("#label_input").css("display","block")}),$("#add_title").click(function(){$("#add_title").css("display","none"),$("#title_input").css("display","block")}),$(".leftwrap").delegate(".replyclose","click",function(){return $("#replywrap").remove(),!1}),$("textarea.atreply").keydown(function(a){13==a.keyCode&&(a.ctrlKey||a.metaKey)&&(a.preventDefault(),$(this).closest("form").submit())}),$("textarea.atreply").live("focus",function(){$(this).css("height","80px"),$(this).parent().find(".inputopt").css("display","inline-block")}),$("textarea.atreply").live("blur",function(){var a=$(this).val();0==a.length&&($(this).css("height","30px"),$(this).parent().find(".inputopt").css("display","none"))}),$("#subarticle").click(function(){var b=$("textarea.atreply").val();return 0==b.length?(a(!1,"cccc"),!1):!0})});