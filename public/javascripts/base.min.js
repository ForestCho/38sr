
 $(document).ready(function(){function a(a){var b,c;for(c=0,b=0;b<a.length;b++)c+=a.charCodeAt(b)>=0&&a.charCodeAt(b)<=255?1:2;return c}var b=$(".username_text").map(function(a,b){return $(b).text().trim()}).toArray();b=_.uniq(b);var c={at:"@",data:b,show_the_at:!0};$inputor=$(".atreply").atwho(c),$("#relatebtn").click(function(){var a=$(this).attr("data_id"),b=!1;b=$(this).hasClass("followfri")?!1:!0;var c={followuid:a,follow:b};$.ajax({data:c,url:"/newrelation",dataType:"json",cache:!1,timeout:5e3,type:"get",success:function(a){return"success"===a.status?($("#relatebtn").text($("#relatebtn").hasClass("followfri")?"取消关注-":"关注此人+"),$("#relatebtn").toggleClass("unfollowfri"),void $("#relatebtn").toggleClass("followfri")):("failed"===a.status&&($("#followerror").remove(),$("#relatebtn").after("<p id='followerror'>请先登录!!</p>"),$("#followerror").fadeOut(3e3)),void("error"===a.status&&($("#followerror").remove(),$("#relatebtn").after("<p id='followerror'>发生错误!!</p>"),$("#followerror").fadeOut(3e3))))}})}),$(".likebtn").click(function(){var a=$(this),b=a.attr("data-tid"),c=!0,d={tid:b,islike:c};$.ajax({data:d,url:"/like",dataType:"json",cache:!1,timeout:5e3,type:"get",success:function(b){if(0===b.status){var c=""===a.children("span").text()?0:a.children("span").text();return void a.children("span").text(c- -1)}return 1===b.status?($("#likeerr").remove(),a.parent().after("<p id='likeerr' style='text-align:center'>请先登录!!</p>"),void $("#likeerr").fadeOut(3e3)):2===b.status?($("#likeerr").remove(),a.parent().after("<p id='likeerr' style='text-align:center'>已经加过油了!!</p>"),void $("#likeerr").fadeOut(3e3)):3===b.status?($("#likeerr").remove(),a.parent().after("<p id='likeerr' style='text-align:center'>发生错误!!</p>"),void $("#likeerr").fadeOut(3e3)):void 0}})}),$(".deleteitem").click(function(){var a=$(this),b=a.attr("data-tid"),c={tid:b};$.ajax({data:c,url:"/deletearticle",dataType:"json",cache:!1,timeout:5e3,type:"get",success:function(b){return 0===b.status?void a.parentsUntil(".user_near_article").remove():3===b.status?($("#likeerr").remove(),a.parent().after("<p id='likeerr' style='text-align:center'>发生错误!!</p>"),void $("#likeerr").fadeOut(3e3)):void 0}})}),$("#regBtnSub").click(function(){var b=$("#email").val(),c=$("#uname").val(),d=$("#pwd").val(),e=$("#pwdagain").val(),f=/^\w+((-\w+)|(\.\w+))*\@[A-Za-z0-9]+((\.|-)[A-Za-z0-9]+)*\.[A-Za-z0-9]+$/;if($(".msgbox").empty(),!f.test(b)){var g="<div class='alertsty' role='alert'>邮箱格式不正确,请重新输入</div>";return $(".msgbox").append(g),$("#email").focus(),!1}if(a(c)<6){var g="<div class='alertsty' role='alert'>账户最少超过6个字符哦</div>";return $(".msgbox").append(g),$("#name").focus(),!1}if(a(d)<6){var g="<div class='alertsty' role='alert'>密码过于简单..</div>";return $(".msgbox").append(g),$("#pwd").focus(),!1}if(d!=e){var g="<div class='alertsty' role='alert'>两次输入不一样</div>";return $(".msgbox").append(g),$("#pwdagain").focus(),!1}return!0}),$("#loginBtnSub").click(function(){var a=$("#uname").val(),b=$("#pwd").val();if($(".msgbox").empty(),0===a.length){var c="<div class='alertsty' role='alert'>账户为空</div>";return $(".msgbox").append(c),$("#name").focus(),!1}if(0===b.length){var c="<div class='alertsty' role='alert'>密码为空</div>";return $(".msgbox").append(c),$("#pwd").focus(),!1}return!0});var d=function(a,b,c,d){var e='<input type="hidden" name="tid" value="'+a+'">',f='<input type="hidden" name="rid" value="'+b+'">',g='<input type="hidden" name="ruid" value="'+c+'">',h='<input type="hidden" name="runame" value="'+d+'">',i='<textarea row="3" name="repstr" class="atreply" id="replytoreply" style="width:80%"></textarea>',j='<div><button type="submit" class="btn  btn-sm">回复</button>',k='<button type="button" class="btn replyclose btn-sm" style="margin-left:20px">取消</button></div>',l='<form id="replywrap" action="/reply" method="post">',m="</form>";return l+i+e+f+g+h+j+k+m};$(".replyat").click(function(){$("#replywrap").remove();var a=$(this).attr("data-tid"),b=$(this).attr("data-rid"),c=$(this).attr("data-ruid"),e=$(this).attr("data-runame"),f=d(a,b,c,e);return $(this).parent().parent().parent().children(".reply_content").after(f),$("#replytoreply").focus(),$("#replytoreply").val("@"+e+" "),!1}),$(".leftwrap").delegate(".replyclose","click",function(){return $("#replywrap").remove(),!1}),$("textarea.atreply").keydown(function(a){13==a.keyCode&&(a.ctrlKey||a.metaKey)&&(a.preventDefault(),$(this).closest("form").submit())})});