$(document).ready(function(){$("#subemail").click(function(){var a=/^\w+((-\w+)|(\.\w+))*\@[A-Za-z0-9]+((\.|-)[A-Za-z0-9]+)*\.[A-Za-z0-9]+$/,b=$("#regemail").val();if(!a.test(b)){var c="<div class='am-alert am-alert-warning' role='alert'>邮箱格式不对哦</div>";return $(".msgbox").append(c),!1}var d={email:b};$.ajax({data:d,url:"/admin/regemail",dataType:"json",cache:!1,timeout:5e3,type:"get",beforeSend:function(){},success:function(a){if(1==a.status){var b="<div class='am-alert am-alert-success' role='alert'>"+a.content+"</div>";$(".msgbox").append(b)}else{var b="<div class='am-alert am-alert-warning' role='alert'>"+a.content+"</div>";$(".msgbox").append(b)}}})}),$("#loginBtnSub").click(function(){var a=$("#uname").val(),b=$("#pwd").val();if($(".msgbox").empty(),0===a.length){var c="<div class='am-alert am-alert-warning' role='alert'>账户为空</div>";return $(".msgbox").append(c),$("#name").focus(),!1}if(0===b.length){var c="<div class='am-alert am-alert-warning' role='alert'>密码为空</div>";return $(".msgbox").append(c),$("#pwd").focus(),!1}return!0});var a=$("#spanMessage"),b=$("#spic");$("#sitepicfile").wrap("<form id='uploadsitepic' action='/admin/sitepicupload' method='post' enctype='multipart/form-data'></form>"),$("#sitepicfile").change(function(){var c="";$.each(this.files,function(){c+='<span class="am-badge">'+this.name+"</span> "}),$("#file-list").html(c),$("#uploadsitepic").ajaxSubmit({dataType:"json",beforeSend:function(){a.text("正在上传...")},success:function(c){0==c.type?a.text("上传失败"):(a.text("上传成功"),b.val(c.content))},error:function(){a.text("上传失败")}})}),$("#addsite").click(function(){var a=$("#sname").val(),b=$("#sdomain").val(),c=$("#sbrief").val(),d=$("#spic").val(),e={sname:a,sbrief:c,sdomain:b,spic:d};$.ajax({data:e,url:"/admin/addsite",dataType:"json",cache:!1,timeout:5e3,type:"get",success:function(a){0===a.status?$("#spanMessage").html("Site增加成功"):$("#spanMessage").html("Site增加失败")},error:function(){$("#spanMessage").html("ERROR")}})}),$("#updatesite").click(function(){var a=$("#snname").val(),b=$("#sndomain").val(),c=$("#snbrief").val(),d=$("#snpic").val(),e={snname:a,snbrief:c,sndomain:b,snpic:d};$.ajax({data:e,url:"/admin/updatesite",dataType:"json",cache:!1,timeout:5e3,type:"get",success:function(a){0===a.status?$("#spanMessage2").html("Site编辑成功"):$("#spanMessage2").html("Site编辑失败")},error:function(){$("#spanMessage2").html("ERROR")}})}),$("#sndomain").blur(function(){var a=$("#snname"),b=$("#sndomain"),c=$("#snbrief"),d=$("#snpic"),e=b.val(),f={domainname:e};$.ajax({data:f,url:"/admin/getsite",dataType:"json",cache:!1,timeout:5e3,type:"get",success:function(b){0===b.status?(a.val(b.site.sname),c.val(b.site.sbrief),d.val(b.site.spic)):($("#spanMessage2").html("Site查找失败"),a.val(""),c.val(""),d.val(""))},error:function(){$("#spanMessage2").html("ERROR")}})}),$(".articledeletebtn").on("click",function(){$("#my-confirm").modal({relatedTarget:this,onConfirm:function(a){var b=$(this.relatedTarget),c=b.data("id"),d={tid:c},e=$("#notice");$.ajax({data:d,url:"/admin/deletearticle",dataType:"json",cache:!1,timeout:5e3,type:"get",success:function(a){return 1===a.status?(e.addClass("am-alert-success"),e.css("display","block"),$("#"+c).remove(),void e.text("删除成功")):-1===a.status?(e.addClass("am-alert-error"),e.css("display","block"),void e.text("系统错误")):0===a.status?(e.addClass("am-alert-warning"),e.css("display","block"),void e.text("参数错误")):void 0},error:function(){e.addClass("am-alert-error"),e.css("display","block"),e.text("参数错误")}})},onCancel:function(){}})});var c=new Editor;c.render(document.getElementById("postcontent")),$("#subarticle").click(function(){var a=c.codemirror.getValue();return 0==a.length?(msgbox.showMsgBox(!1,"输入不能为空"),!1):a.length<10?(msgbox.showMsgBox(!1,"输入不能为空"),!1):!0}),$("#link").change(function(){$("#link").val().length>0?$("#insertlinkbtn").show():$("#insertlinkbtn").hide()}),$("#insertlinkbtn").click(function(){var a=$("#linkmodal"),b=$("#linkname").val(),d=$("#link").val();c.codemirror.replaceSelection("["+b+"]("+d+")"),a.modal("hide")}),$("#savepic").click(function(){var a=$("#imagemodal"),b=$("#submitinfo").text(),d=b.lastIndexOf("/"),e=b.length,f=b.substring(d>0?d+1:0,e>0?e:0);c.codemirror.replaceSelection("!["+f+"]("+b+")"),a.modal("hide")});var d=$(".submitinfo"),e=$("#savepic");$("#choose").wrap("<form id='uploadpic' action='/picupload' method='post' enctype='multipart/form-data'></form>"),$("#choose").change(function(){$("#uploadpic").ajaxSubmit({dataType:"json",beforeSend:function(){d.text("正在上传..."),e.hide()},success:function(a){0==a.type?d.text(a.content):(d.text(a.content),e.show())},error:function(){e.hide()}})});var d=$("#submitinfo"),e=$("#savepic");$("#narrowimg").wrap("<form id='uploadpic' action='/admin/picupload' method='post' enctype='multipart/form-data'></form>"),$("#narrowimg").change(function(){$("#uploadpic").ajaxSubmit({dataType:"json",beforeSend:function(){d.html('<span class="am-badge">正在上传</span> ')},success:function(a){0==a.status?(d.html('<span class="am-badge">'+a.content+"</span> "),$("#smallimg").val(a.content),$("#disnarrow").attr("src",a.content)):d.html('<span class="am-badge">'+a.content+"</span> ")},error:function(){}})})});