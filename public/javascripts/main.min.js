require.config({shim:{bootstrap:["jquery"],jqueryform:["jquery"],jqueryatwho:["jquery"],jqueryjcrop:["jquery"],jquerymigrate:["jquery"],zoom:["jquery"],popover:["jquery"]},paths:{jquery:"./lib/jquery.min",jqueryform:"./lib/jquery.form.min",jquerycaret:"./lib/jquery.caret.min",jqueryjcrop:"./lib/jquery.jcrop.min",jquerymigrate:"./lib/jquery.migrate.min",bootstrap:"./lib/bootstrap.min",underscore:"./lib/underscore.min",jqueryatwho:"./lib/jquery.atwho.min",editor:"./lib/editor.min",pretty:"./lib/pretty.min",popover:"./lib/jquery.webui.popover",zoom:"./lib/zoom.min"}}),define("domop",function(){return{hasClass:function(a,b){return a.className.match(new RegExp("(\\s|^)"+b+"(\\s|$)"))},addClass:function(a,b){this.hasClass(a,b)||(a.className+=" "+b)},removeClass:function(a,b){if(this.hasClass(a,b)){var c=new RegExp("(\\s|^)"+b+"(\\s|$)");a.className=a.className.replace(c," ")}},toggleClass:function(a,b){this.hasClass(a,b)?this.removeClass(a,b):this.addClass(a,b)}}}),define("msgbox",["domop"],function(a){function b(){a.removeClass(e,"msgboxin"),a.addClass(e,"msgboxout"),a.removeClass(e,"msgbox_success"),a.removeClass(e,"msgbox_error")}function c(){a.removeClass(e,"msgboxout"),a.addClass(e,"msgboxin")}var d=document.getElementsByTagName("body")[0],e=document.createElement("div");return a.addClass(e,"fade_trans"),a.addClass(e,"msgboxout"),e.setAttribute("id","gmsgbox"),d.insertBefore(e,d.childNodes[0]),{showMsgBox:function(d,f){1==d?a.addClass(e,"msgbox_success"):a.addClass(e,"msgbox_error"),e.innerHTML=f,c(),setTimeout(b,1500)}}}),define("index",["msgbox","jquery","popover","zoom"],function(a,b){b(".articleitem").hover(function(){b(this).find(".otherinfowrap").css("opacity","1")},function(){b(this).find(".otherinfowrap").css("opacity","0.8")}),b(".likebtn,.unlikebtn").click(function(){var c=b(this),d=c.attr("data-tid"),e=!0,f="表过态";e="赞"===c.attr("title")?!0:!1;var g={tid:d,islike:e};b.ajax({data:g,url:"/like",dataType:"json",cache:!1,timeout:5e3,type:"get",success:function(b){if(0===b.status){var d=""===c.children("span").text()?0:c.children("span").text();return c.children("span").text(d- -1),void a.showMsgBox(!0,"操作成功!!")}return 1===b.status?void a.showMsgBox(!1,"请先登录!!"):2===b.status?void a.showMsgBox(!1,"已经"+f+"了!!"):3===b.status?void a.showMsgBox(!1,"发生错误!!"):void 0}})}),function(){function a(){var a={width:"auto",height:"auto",closeable:!0,padding:!1,cache:!1,url:"/userinfo/",type:"async",content:function(a){title="ccc";var b='<ul class="list-group">';return b+='<li class="list-group-item">昵称:'+a.name+"</li>",b+='<li class="list-group-item">加入:'+a.cometime+"</li>",b+='<li class="list-group-item">心情数:'+a.articlenum+"</li>",b+="</ul>"}};b("a.show-pop-async").webuiPopover("destroy").webuiPopover(b.extend({},c,a)),b("a.show-pop-event").each(function(a,d){var e=b(d).text()+".webui.popover";b(d).webuiPopover("destroy").webuiPopover(c).on(e,function(){var a=e+" is trigged!";console&&console.log(a),b("#eventLogs").text(b("#eventLogs").text()+"\n"+a)})})}var c={trigger:"hover",title:"38锶",content:"<p>This is webui popover demo.</p><p>just enjoy it and have fun !</p>",width:250,multi:!0,closeable:!0,style:"",padding:!1};a()}()}),define("reglog",["msgbox","jquery"],function(a,b){function c(a){var b,c;for(c=0,b=0;b<a.length;b++)c+=a.charCodeAt(b)>=0&&a.charCodeAt(b)<=255?1:2;return c}b("#regBtnSub").click(function(){var a=b("#email").val(),d=b("#uname").val(),e=b("#pwd").val(),f=b("#pwdagain").val(),g=/^\w+((-\w+)|(\.\w+))*\@[A-Za-z0-9]+((\.|-)[A-Za-z0-9]+)*\.[A-Za-z0-9]+$/,h=/^[\u4E00-\u9FA5\uf900-\ufa2d\w]{4,16}$/;if(b(".msgbox").empty(),!g.test(a)){var i="<div class='alertsty' role='alert'>邮箱格式不正确,请重新输入</div>";return b(".msgbox").append(i),b("#email").focus(),!1}if(c(d)<4){var i="<div class='alertsty' role='alert'>账户最少超过4个字符哦</div>";return b(".msgbox").append(i),b("#name").focus(),!1}if(!h.test(d)){var i="<div class='alertsty' role='alert'>账号只能是4-16位的汉字，字符或者下划线</div>";return b(".msgbox").append(i),b("#name").focus(),!1}if(c(e)<6){var i="<div class='alertsty' role='alert'>密码过于简单..</div>";return b(".msgbox").append(i),b("#pwd").focus(),!1}if(e!=f){var i="<div class='alertsty' role='alert'>两次输入不一样</div>";return b(".msgbox").append(i),b("#pwdagain").focus(),!1}return!0}),b("#loginBtnSub").click(function(){var a=b("#uname").val(),c=b("#pwd").val();if(b(".msgbox").empty(),0===a.length){var d="<div class='alertsty' role='alert'>账户为空</div>";return b(".msgbox").append(d),b("#name").focus(),!1}if(0===c.length){var d="<div class='alertsty' role='alert'>密码为空</div>";return b(".msgbox").append(d),b("#pwd").focus(),!1}return!0}),b("#getpwdbtn").click(function(){{var a=/^\w+((-\w+)|(\.\w+))*\@[A-Za-z0-9]+((\.|-)[A-Za-z0-9]+)*\.[A-Za-z0-9]+$/,c=b("#email").val();b("#noticemsg")}if(!a.test(c)){var d="<div class='alertsty' role='alert'>邮箱格式不正确</div>";return b(".msgbox").append(d),b("#email").focus(),!1}return!0})}),define("pub",["msgbox","jquery","bootstrap","editor"],function(a,b,c,d){var d=new Editor;route=route||"","pub"==route&&d.render(document.getElementById("postcontent")),b("#add_title").click(function(){b("#add_title").css("display","none"),b("#title_input").css("display","block")}),b("#tab_share_on").click(function(){b("#tab_link").removeClass("tab_on"),b("#tab_link").addClass("tab_off"),b("#tab_share").removeClass("tab_off"),b("#tab_share").addClass("tab_on"),b(this).addClass("share_tab_active"),b("#tab_link_on").removeClass("share_tab_active")}),b("#tab_link_on").click(function(){b("#tab_share").removeClass("tab_on"),b("#tab_share").addClass("tab_off"),b("#tab_link").removeClass("tab_off"),b("#tab_link").addClass("tab_on"),b(this).addClass("share_tab_active"),b("#tab_share_on").removeClass("share_tab_active")}),b("#searchtitle").click(function(){var c=b("#url").val(),d=b("#pub_link_brief");if(0==c.length)return a.showMsgBox(!1,"输入不能为空"),!1;if(c.indexOf("http")<0)return a.showMsgBox(!1,"链接地址不合法"),!1;var e={url:c};return b.ajax({data:e,url:"/getlinktitle",dataType:"json",cache:!1,timeout:5e3,type:"get",beforeSend:function(){b(".loading").css("display","inline-block")},success:function(c){return b(".loading").css("display","none"),0===c.status?(d.val(c.title),!1):1===c.status?(d.val(""),a.showMsgBox(!1,c.title),d.attr("placeholder",c.title),!1):void 0}}),!1}),b("#sublink").click(function(){var c=b("#url").val(),d=b("#pub_link_brief").val();return 0==c.length?(a.showMsgBox(!1,"输入不能为空"),!1):0==d.length?(a.showMsgBox(!1,"链接简介是不是空的呀？"),!1):!0}),b("#subarticle").click(function(){var b=d.codemirror.getValue();return 0==b.length?(a.showMsgBox(!1,"输入不能为空"),!1):b.length<10?(a.showMsgBox(!1,"输入不能为空"),!1):!0}),b("#link").change(function(){b("#link").val().length>0?b("#insertlinkbtn").show():b("#insertlinkbtn").hide()}),b("#insertlinkbtn").click(function(){var a=b("#linkmodal"),c=b("#linkname").val(),e=b("#link").val();d.codemirror.replaceSelection("["+c+"]("+e+")"),a.modal("hide")}),b("#savepic").click(function(){var a=b("#imagemodal"),c=b("#submitinfo").text(),e=c.lastIndexOf("/"),f=c.length,g=c.substring(e>0?e+1:0,f>0?f:0);d.codemirror.replaceSelection("!["+g+"]("+c+")"),a.modal("hide")});var e=b(".submitinfo"),f=b("#savepic");b("#choose").wrap("<form id='uploadpic' action='/picupload' method='post' enctype='multipart/form-data'></form>"),b("#choose").change(function(){b("#uploadpic").ajaxSubmit({dataType:"json",beforeSend:function(){e.text("正在上传..."),f.hide()},success:function(a){0==a.type?e.text(a.content):(e.text(a.content),f.show())},error:function(){f.hide()}})})}),define("user",["msgbox","jquery"],function(a,b){b(".deleteitem").click(function(){if(confirm("你确定提交吗？")){var c=b(this),d=c.attr("data-tid"),e={tid:d};b.ajax({data:e,url:"/deletearticle",dataType:"json",cache:!1,timeout:5e3,type:"get",success:function(d){return 0===d.status?(c.parentsUntil(".user_near_article").remove(),void a.showMsgBox(!0,"删除成功!!")):3===d.status?(b("#likeerr").remove(),void a.showMsgBox(!1,"发生错误!!")):void 0}})}})}),define("set",["jquery","jqueryjcrop"],function(a){function b(b){if(parseInt(b.w)>0){var c=a("#preview_box").width()/b.w,d=a("#preview_box").height()/b.h;a("#crop_preview").css({width:Math.round(c*a("#xuwanting").width())+"px",height:Math.round(d*a("#xuwanting").height())+"px",marginLeft:"-"+Math.round(c*b.x)+"px",marginTop:"-"+Math.round(d*b.y)+"px"}),a("#coords").val(b.x+"_"+b.y+"_"+b.w+"_"+b.h)}}a("#xuwanting").Jcrop({setSelect:[0,0,64,64],aspectRatio:1,onChange:b,allowSelect:!1})}),define("article",["msgbox","jquery","jquerymigrate","jquerycaret","underscore","jqueryatwho","pretty"],function(a,b,c,d,e){b(".detail_content pre").addClass("prettyprint "),b(".detail_content pre").addClass("linenums "),prettyPrint();var f=b(".username_text").map(function(a,c){return b(c).text().trim()}).toArray();f=e.uniq(f);var g={at:"@",data:f,show_the_at:!0};$inputor=b(".atreply").atwho(g),b("#relatebtn").click(function(){var c=b(this).attr("data_id"),d=!1;d=b(this).hasClass("followfri")?!0:!1;var e={followuid:c,follow:d};b.ajax({data:e,url:"/newrelation",dataType:"json",cache:!1,timeout:5e3,type:"get",success:function(c){return"success"===c.status?(b("#relatebtn").text(b("#relatebtn").hasClass("followfri")?"取消关注-":"关注此人+"),b("#relatebtn").toggleClass("unfollowfri"),b("#relatebtn").toggleClass("followfri"),void a.showMsgBox(!0,"操作成功!!")):("failed"===c.status&&a.showMsgBox(!1,"请先登录!!"),void("error"===c.status&&a.showMsgBox(!1,"发生错误!!")))}})});var h=function(a,b,c,d){var e='<input type="hidden" name="tid" value="'+a+'">',f='<input type="hidden" name="rid" value="'+b+'">',g='<input type="hidden" name="ruid" value="'+c+'">',h='<input type="hidden" name="runame" value="'+d+'">',i='<textarea row="3" name="repstr" class="atreply" id="replytoreply" style="width:100%;resize: vertical;"></textarea>',j='<div class="inputopt"><button type="submit" class="btn  btn-sm">回复</button></div>',k='<form id="replywrap" class="navbar-form" action="/reply" method="post">',l="</form>";return k+i+e+f+g+h+j+l};b(".replyat").click(function(){b("#replywrap").remove();var a=b(this).attr("data-tid"),c=b(this).attr("data-rid"),d=b(this).attr("data-ruid"),e=b(this).attr("data-runame"),f=h(a,c,d,e);return b(this).parent().parent().parent().children(".reply_content").after(f),b("#replytoreply").focus(),b("#replytoreply").val("@"+e+" "),!1}),b("textarea.atreply").keydown(function(a){13==a.keyCode&&(a.ctrlKey||a.metaKey)&&(a.preventDefault(),b(this).closest("form").submit())}),b("textarea.atreply").live("focus",function(){b(this).css("height","80px"),b(this).parent().find(".inputopt").css("display","inline-block")}),b("textarea.atreply").live("blur",function(){var a=b(this).val();0==a.length&&(b(this).css("height","30px"),b(this).parent().find(".inputopt").css("display","none"))})}),define("common",["domop","jquery","bootstrap"],function(a,b){function c(a){document.documentElement.scrollTop=a,document.body.scrollTop=a}function d(){return document.documentElement.scrollTop|document.body.scrollTop}b("#gotologin").click(function(){b("#regmodal").modal("hide"),b("#loginmodal").modal("show")}),b("#gotoreg").click(function(){b("#loginmodal").modal("hide"),b("#regmodal").modal("show")}),b("#sublogin").click(function(){var a=b("#uname").val(),c=b("pwd").val(),d=b("#noticemsg1");return a.length<5?(d.html("账号格式有误"),!1):c.length<7?(d.html("密码输入不对"),!1):!0}),b("#subemail").click(function(){var a=/^\w+((-\w+)|(\.\w+))*\@[A-Za-z0-9]+((\.|-)[A-Za-z0-9]+)*\.[A-Za-z0-9]+$/,c=b("#regemail").val(),d=b("#noticemsg");if(!a.test(c))return d.html("邮箱格式不对哦"),!1;var e={email:c};b.ajax({data:e,url:"/regemail",dataType:"json",cache:!1,timeout:5e3,type:"get",beforeSend:function(){},success:function(a){d.html(1==a.status?a.content:a.content)}})}),b("[data-toggle='tooltip']").tooltip();var e=document.getElementById("gotopbtn");e.onclick=function(){function a(){c(d()/1.1),d()<1&&clearInterval(b)}var b=setInterval(a,10)},window.onscroll=function(){{var b=document.documentElement.scrollTop||document.body.scrollTop,c=document.getElementsByTagName("body")[0];document.getElementById("navigate")}b>=130?a.addClass(c,"headon"):a.removeClass(c,"headon"),e.style.bottom=d()>130?"80px":"-45px"};var f=document.getElementsByClassName("btn-search")[0],g=document.getElementsByClassName("btn-close")[0],h=document.getElementsByClassName("form-search")[0],i=document.getElementsByClassName("search-ipt")[0];f.onclick=function(){a.addClass(h,"active"),i.focus()},g.onclick=function(){a.removeClass(h,"active")},i.onblur=function(){a.removeClass(h,"active")}}),require(["jquery","bootstrap","jqueryform","jquerycaret","underscore","jquerymigrate","jqueryatwho","index","article","pub","reglog","user","set","common"],function(){});